import{r as i,j as e,b as x,c as S,B as N,d as E,O as D,R as I,a as U,g as B}from"./index-DbLyi6td.js";const z=({singleUser:s,index:r,updateUserActivity:a,selectUserForPermission:f})=>{const[c,j]=i.useState(s.isActive),u=s.email.split("@")[0],y=m=>{m.stopPropagation(),a(s._id,!c,j)};return e.jsxs("tr",{onClick:()=>f(s),className:"h-12 cursor-pointer border-b border-x border-blue-gray-200 odd:bg-gray-50 even:bg-gray-100 text-blue-gray-600 hover:bg-white",children:[e.jsx("td",{className:"text-center",children:r+1}),e.jsx("td",{className:"",children:u}),e.jsx("td",{className:"",children:s.email}),e.jsx("td",{className:"text-center",children:e.jsx(x.Button,{onClick:y,className:`${c?"bg-blue-600":"bg-blue-gray-600"} p-2 w-20 rounded capitalize font-normal`,children:c?"Active":"Inactive"})})]})},H=async()=>{try{const s=await S.get("/admin/getAllUsers");if(s)return s.data}catch(s){console.error(`Error fetching users: ${s.message}`),N.error(s.message)}},R=async(s,r)=>{try{const a=await S.patch("/admin/userStatus",{id:s,isActive:r});if(a)return a.data}catch(a){N.error(a.message)}},M=async(s,r)=>{try{const a=await S.put("/admin/updatePermissions",{userId:s,permissions:r});if(a)return a.data}catch(a){N.error(a.message)}},$=({singleProject:s,permissions:r,setPermissions:a})=>{var p,w,v,_,P,k;const[f,c]=i.useState(r!=null&&r.length?!!((w=(p=r.find(l=>l.projectId===s._id))==null?void 0:p.allowedPermissions)!=null&&w.includes("dueDate")):!1),[j,u]=i.useState(r!=null&&r.length?!!((_=(v=r.find(l=>l.projectId===s._id))==null?void 0:v.allowedPermissions)!=null&&_.includes("priority")):!1),[y,m]=i.useState(r!=null&&r.length?!!((k=(P=r.find(l=>l.projectId===s._id))==null?void 0:P.allowedPermissions)!=null&&k.includes("people")):!1),[g,t]=i.useState(r!=null&&r.length?r.some(l=>l.projectId===s._id):!1),n=l=>{l.target.checked?a(d=>d.length?[...d,{projectId:s._id,allowedPermissions:[]}]:[{projectId:s._id,allowedPermissions:[]}]):a(d=>d==null?void 0:d.filter(o=>(o==null?void 0:o.projectId)!==s._id)),t(d=>!d)},b=(l,d)=>{switch(a(l?o=>o.map(h=>h.projectId===s._id?{...h,allowedPermissions:[...h.allowedPermissions,d]}:h):o=>o.map(h=>h.projectId===s._id?{...h,allowedPermissions:h.allowedPermissions.filter(C=>C!==d)}:h)),d){case"dueDate":c(o=>!o);break;case"priority":u(o=>!o);break;case"people":m(o=>!o);break}};return e.jsxs("tr",{className:"h-10 odd:bg-gray-100 even:bg-brown-50 hover:bg-white capitalize",children:[e.jsx("td",{className:"text-center border border-blue-gray-200",children:e.jsx("input",{onChange:n,className:"cursor-pointer",type:"checkbox",checked:g})}),e.jsx("td",{className:" border border-blue-gray-200",children:s.name}),e.jsx("td",{className:"border border-blue-gray-200",children:e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(x.Switch,{onChange:l=>b(l.target.checked,"dueDate"),disabled:!g,color:"blue",size:"sm",checked:f})})}),e.jsx("td",{className:"border border-blue-gray-200",children:e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(x.Switch,{onChange:l=>b(l.target.checked,"priority"),disabled:!g,color:"blue",size:"sm",checked:j})})}),e.jsx("td",{className:"border border-blue-gray-200",children:e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(x.Switch,{onChange:l=>b(l.target.checked,"people"),disabled:!g,color:"blue",size:"sm",checked:y})})})]})},F=({selectedUserId:s,userPermissions:r,permissionModalHandler:a})=>{const f=E(D),[c,j]=I(U),[u,y]=i.useState(r),m=async()=>{const t=await B();t!=null&&t.status&&j(t.data)};i.useEffect(()=>{m()},[]);const g=async()=>{const t=await M(s,u);t!=null&&t.status?(f(n=>n.map(b=>b._id===s?{...b,permissions:u}:b)),a(),N.success(t.message)):N.error(t.message)};return e.jsxs("div",{children:[e.jsx(x.DialogHeader,{children:e.jsx("p",{className:"mx-auto",children:"Permission Settings"})}),e.jsx(x.DialogBody,{className:"overflow-x-scroll",children:e.jsxs("table",{className:"w-full text-left table-auto min-w-max",children:[e.jsxs("thead",{children:[e.jsxs("tr",{className:"font-normal text-sm",children:[e.jsx("th",{rowSpan:2,className:"p-1 border border-blue-gray-200 bg-blue-gray-50 text-center",children:"Select"}),e.jsx("th",{rowSpan:2,className:"p-1 border border-blue-gray-200 bg-blue-gray-50 text-center",children:"Project Name"}),e.jsx("th",{colSpan:3,className:"p-1 border border-blue-gray-200 bg-blue-gray-50 text-center",children:"Permissions"})]}),e.jsxs("tr",{className:"font-normal text-sm text-center",children:[e.jsx("th",{className:"p-1 border border-blue-gray-200 bg-blue-gray-50",children:"Due Date"}),e.jsx("th",{className:"p-1 border border-blue-gray-200 bg-blue-gray-50",children:"Priority"}),e.jsx("th",{className:"p-1 border border-blue-gray-200 bg-blue-gray-50",children:"People"})]})]}),e.jsx("tbody",{className:"overflow-y-scroll",children:c.length?c.map(t=>e.jsx($,{singleProject:t,permissions:u,setPermissions:y},t._id)):null})]})}),e.jsx(x.DialogFooter,{children:e.jsx(x.Button,{onClick:g,color:"blue",className:"p-2 rounded mx-auto",children:"Update"})})]})},A=["Sl.No.","User Id","Email","Status"],O=()=>{const[s,r]=I(D),[a,f]=i.useState(!1),[c,j]=i.useState({}),u=async()=>{const t=await H();t!=null&&t.status?r(t.data):N.error("No users found")};i.useEffect(()=>{u()},[]);const y=async(t,n,b)=>{const p=await R(t,n);p!=null&&p.status&&b(w=>!w)},m=()=>{f(t=>!t)},g=t=>{m(),j(t)};return e.jsxs("div",{className:"flex-1 w-full mt-14 p-5 h-[calc(100vh-3.5rem)]",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Permissions"}),e.jsx("p",{className:"mt-2",children:"Choose a user to manage their permissions"}),e.jsx("div",{className:"mt-6 w-full overflow-x-scroll",children:e.jsxs("table",{className:"table-auto w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border border-blue-gray-200",children:A.map((t,n)=>e.jsx("th",{className:`${n===0||n===A.length-1?"text-center":"text-left"} p-2 text-sm bg-blue-gray-50`,children:t},n))})}),e.jsx("tbody",{className:"overflow-y-scroll",children:s!=null&&s.length?s.map((t,n)=>e.jsx(z,{singleUser:t,index:n,updateUserActivity:y,selectUserForPermission:g},t._id)):null})]})}),e.jsx(x.Dialog,{open:a,handler:m,size:"md",children:e.jsx(F,{selectedUserId:c==null?void 0:c._id,userPermissions:c==null?void 0:c.permissions,permissionModalHandler:m})})]})};export{O as default};
