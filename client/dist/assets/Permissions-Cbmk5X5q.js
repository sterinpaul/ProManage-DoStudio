import{r as i,j as e,b as x,c as S,B as w,R as I,a as C,g as E}from"./index-B8z5zu3U.js";const B=({singleUser:t,index:r,updateUserActivity:a,selectUserForPermission:f})=>{const[c,j]=i.useState(t.isActive),u=t.email.split("@")[0],y=m=>{m.stopPropagation(),a(t._id,!c,j)};return e.jsxs("tr",{onClick:()=>f(t),className:"h-12 cursor-pointer border-b border-x border-blue-gray-200 odd:bg-gray-50 even:bg-gray-100 text-blue-gray-600 hover:bg-white",children:[e.jsx("td",{className:"text-center",children:r+1}),e.jsx("td",{className:"",children:u}),e.jsx("td",{className:"",children:t.email}),e.jsx("td",{className:"text-center",children:e.jsx(x.Button,{onClick:y,className:`${c?"bg-blue-600":"bg-blue-gray-600"} p-2 w-20 rounded capitalize font-normal`,children:c?"Active":"Inactive"})})]})},z=async()=>{try{const t=await S.get("/admin/getAllUsers");if(t)return t.data}catch(t){console.error(`Error fetching users: ${t.message}`),w.error(t.message)}},H=async(t,r)=>{try{const a=await S.patch("/admin/userStatus",{id:t,isActive:r});if(a)return a.data}catch(a){w.error(a.message)}},U=async(t,r)=>{try{const a=await S.put("/admin/updatePermissions",{userId:t,permissions:r});if(a)return a.data}catch(a){w.error(a.message)}},R=({singleProject:t,permissions:r,setPermissions:a})=>{var p,N,v,P,k,_;const[f,c]=i.useState(r!=null&&r.length?!!((N=(p=r.find(l=>l.projectId===t._id))==null?void 0:p.allowedPermissions)!=null&&N.includes("dueDate")):!1),[j,u]=i.useState(r!=null&&r.length?!!((P=(v=r.find(l=>l.projectId===t._id))==null?void 0:v.allowedPermissions)!=null&&P.includes("priority")):!1),[y,m]=i.useState(r!=null&&r.length?!!((_=(k=r.find(l=>l.projectId===t._id))==null?void 0:k.allowedPermissions)!=null&&_.includes("people")):!1),[g,s]=i.useState(r!=null&&r.length?r.some(l=>l.projectId===t._id):!1),n=l=>{l.target.checked?a(d=>d.length?[...d,{projectId:t._id,allowedPermissions:[]}]:[{projectId:t._id,allowedPermissions:[]}]):a(d=>d==null?void 0:d.filter(o=>(o==null?void 0:o.projectId)!==t._id)),s(d=>!d)},b=(l,d)=>{switch(a(l?o=>o.map(h=>h.projectId===t._id?{...h,allowedPermissions:[...h.allowedPermissions,d]}:h):o=>o.map(h=>h.projectId===t._id?{...h,allowedPermissions:h.allowedPermissions.filter(D=>D!==d)}:h)),d){case"dueDate":c(o=>!o);break;case"priority":u(o=>!o);break;case"people":m(o=>!o);break}};return e.jsxs("tr",{className:"h-10 odd:bg-gray-100 even:bg-brown-50 hover:bg-white capitalize",children:[e.jsx("td",{className:"text-center border border-blue-gray-200",children:e.jsx("input",{onChange:n,className:"cursor-pointer",type:"checkbox",checked:g})}),e.jsx("td",{className:" border border-blue-gray-200",children:t.name}),e.jsx("td",{className:"border border-blue-gray-200",children:e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(x.Switch,{onChange:l=>b(l.target.checked,"dueDate"),disabled:!g,color:"blue",size:"sm",checked:f})})}),e.jsx("td",{className:"border border-blue-gray-200",children:e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(x.Switch,{onChange:l=>b(l.target.checked,"priority"),disabled:!g,color:"blue",size:"sm",checked:j})})}),e.jsx("td",{className:"border border-blue-gray-200",children:e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(x.Switch,{onChange:l=>b(l.target.checked,"people"),disabled:!g,color:"blue",size:"sm",checked:y})})})]})},M=({selectedUserId:t,userPermissions:r,permissionModalHandler:a,setUsers:f})=>{const[c,j]=I(C),[u,y]=i.useState(r),m=async()=>{const s=await E();s!=null&&s.status&&j(s.data)};i.useEffect(()=>{m()},[]);const g=async()=>{const s=await U(t,u);s!=null&&s.status?(f(n=>n.map(b=>b._id===t?{...b,permissions:u}:b)),a(),w.success(s.message)):w.error(s.message)};return e.jsxs("div",{children:[e.jsx(x.DialogHeader,{children:e.jsx("p",{className:"mx-auto",children:"Permission Settings"})}),e.jsx(x.DialogBody,{className:"overflow-x-scroll",children:e.jsxs("table",{className:"w-full text-left table-auto min-w-max",children:[e.jsxs("thead",{children:[e.jsxs("tr",{className:"font-normal text-sm",children:[e.jsx("th",{rowSpan:2,className:"p-1 border border-blue-gray-200 bg-blue-gray-50 text-center",children:"Select"}),e.jsx("th",{rowSpan:2,className:"p-1 border border-blue-gray-200 bg-blue-gray-50 text-center",children:"Project Name"}),e.jsx("th",{colSpan:3,className:"p-1 border border-blue-gray-200 bg-blue-gray-50 text-center",children:"Permissions"})]}),e.jsxs("tr",{className:"font-normal text-sm text-center",children:[e.jsx("th",{className:"p-1 border border-blue-gray-200 bg-blue-gray-50",children:"Due Date"}),e.jsx("th",{className:"p-1 border border-blue-gray-200 bg-blue-gray-50",children:"Priority"}),e.jsx("th",{className:"p-1 border border-blue-gray-200 bg-blue-gray-50",children:"People"})]})]}),e.jsx("tbody",{className:"overflow-y-scroll",children:c.length?c.map(s=>e.jsx(R,{singleProject:s,permissions:u,setPermissions:y},s._id)):null})]})}),e.jsx(x.DialogFooter,{children:e.jsx(x.Button,{onClick:g,color:"blue",className:"p-2 rounded mx-auto",children:"Update"})})]})},A=["Sl.No.","User Id","Email","Status"],F=()=>{const[t,r]=i.useState([]),[a,f]=i.useState(!1),[c,j]=i.useState({}),u=async()=>{const s=await z();s!=null&&s.status?r(s.data):w.error("No users found")};i.useEffect(()=>{u()},[]);const y=async(s,n,b)=>{const p=await H(s,n);p!=null&&p.status&&b(N=>!N)},m=()=>{f(s=>!s)},g=s=>{m(),j(s)};return e.jsxs("div",{className:"mt-14 mr-1 mb-1 p-5 w-full h-[calc(100vh-3.8rem)] overflow-y-hidden",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Permissions"}),e.jsx("p",{className:"mt-2",children:"Choose a user to manage their permissions"}),e.jsx("div",{className:"mt-6 w-full overflow-x-scroll",children:e.jsxs("table",{className:"table-auto w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border border-blue-gray-200",children:A.map((s,n)=>e.jsx("th",{className:`${n===0||n===A.length-1?"text-center":"text-left"} p-2 text-sm bg-blue-gray-50`,children:s},n))})}),e.jsx("tbody",{className:"overflow-y-scroll",children:t!=null&&t.length?t.map((s,n)=>e.jsx(B,{singleUser:s,index:n,updateUserActivity:y,selectUserForPermission:g},s._id)):null})]})}),e.jsx(x.Dialog,{open:a,handler:m,size:"md",children:e.jsx(M,{selectedUserId:c==null?void 0:c._id,userPermissions:c==null?void 0:c.permissions,permissionModalHandler:m,setUsers:r})})]})};export{F as default};
